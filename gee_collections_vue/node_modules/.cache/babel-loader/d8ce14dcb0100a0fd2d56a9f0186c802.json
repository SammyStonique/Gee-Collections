{"ast":null,"code":"import { ref, reactive } from \"vue\";\nimport LoadingView from \"@/components/LoadingView.vue\";\nimport Multiselect from 'vue-multiselect';\nexport default {\n  props: [\"getAllCustomers\", \"customersArray\", 'showClientOrders', 'myOrders', 'loader', 'showLoader', 'hideLoader', 'loaderIndex'],\n  components: {\n    LoadingView,\n    Multiselect\n  },\n\n  // setup(){\n  //     const selectedCustomer = ref(null)\n  //     const state = reactive({\n  //         customer: \"\",\n  //         date: \"\",\n  //         order: \"\",\n  //         reference_no: \"\",\n  //         payment_method: \"\",\n  //         amount: 0,\n  //         orders: [],\n  //         customerOrders: [],\n  //         email: \"\",\n  //     });\n  //     const showOrders = ()=>{\n  //        state.email = this.customersArray[selectedCustomer.selectedIndex].email;\n  //        console.log(\"The email is \", state.email)\n  //        console.log(\"The selcted index is \",selectedCustomer.selectedIndex)\n  //         // this.axios\n  //         // .get(`api/v1/orders/${user}/`)\n  //         // .then((response) => {\n  //         //     state.orders = response.data;\n  //         //     state.customerOrders = state.orders[selectedCustomer.selectedIndex];\n  //         // })\n  //         // .catch((error) => {\n  //         // console.log(error);\n  //         // });\n  //     }\n  //     return{\n  //         selectedCustomer, showOrders\n  //     }\n  // },\n  data() {\n    return {\n      email: \"\",\n      customerID: \"\",\n      selectedCust: 0,\n      selectedOrd: 0,\n      orders: [],\n      cstOrders: [],\n      errors: [],\n      receipt_date: \"\",\n      payment_method: \"\",\n      reference_no: \"\",\n      amount_received: 0,\n      customer: \"\",\n      customer_order: \"\",\n      balance: 0,\n      order_id: \"\",\n      payment_status: false,\n      order_first_name: \"\",\n      order_last_name: \"\",\n      order_email: \"\",\n      order_phone_number: \"\",\n      order_county: \"\",\n      order_city: \"\",\n      order_address: \"\",\n      order_items: [],\n      order_order_total: 0,\n      order_delivery_fee: 0,\n      order_coupon: [],\n      generated_receipt: [],\n      coupon_code: \"\",\n      coupon_status: \"Activated\",\n      options: []\n    };\n  },\n\n  methods: {\n    showOrders() {\n      this.cstOrders = [];\n      this.selectedCust = this.$refs.customerSelect.selectedIndex - 1;\n      this.email = this.customersArray[this.selectedCust].email;\n      this.customerID = this.customersArray[this.selectedCust].id;\n      this.axios.get(`api/v1/orders/?=${this.email}/`).then(response => {\n        this.orders = response.data;\n\n        for (let i = 0; i < this.orders.length; i++) {\n          if (this.orders[i].user == this.email && this.orders[i].paid == false) {\n            this.cstOrders.push(this.orders[i]);\n          }\n        }\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n\n    setOrderID() {\n      this.order_id = \"\";\n      this.order_first_name = \"\";\n      this.order_last_name = \"\";\n      this.order_email = \"\";\n      this.order_phone_number = \"\";\n      this.order_county = \"\";\n      this.order_city = \"\";\n      this.order_address = \"\";\n      this.order_order_total = 0;\n      this.order_delivery_fee = 0;\n      this.order_items = [];\n      this.payment_status = false;\n      this.selectedOrd = this.$refs.orderSelect.selectedIndex - 1;\n      this.order_id = this.cstOrders[this.selectedOrd].id;\n      this.payment_status = this.cstOrders[this.selectedOrd].paid;\n      this.order_first_name = this.cstOrders[this.selectedOrd].first_name;\n      this.order_last_name = this.cstOrders[this.selectedOrd].last_name;\n      this.order_email = this.cstOrders[this.selectedOrd].email;\n      this.order_phone_number = this.cstOrders[this.selectedOrd].phone_number;\n      this.order_county = this.cstOrders[this.selectedOrd].county;\n      this.order_city = this.cstOrders[this.selectedOrd].city;\n      this.order_address = this.cstOrders[this.selectedOrd].address;\n      this.order_order_total = this.cstOrders[this.selectedOrd].order_total;\n      this.order_delivery_fee = this.cstOrders[this.selectedOrd].delivery_fee;\n      this.order_items = this.cstOrders[this.selectedOrd].items;\n      this.coupon_applied = this.cstOrders[this.selectedOrd].coupon_applied;\n    },\n\n    createReceipt() {\n      this.showLoader();\n      this.errors = [];\n\n      if (this.customer === \"\" && this.receipt_date === \"\" && this.payment_method === \"\" && this.customer_order === \"\" && this.reference_no === \"\" && this.amount_received === \"\") {\n        this.errors.push(\"Please fill in the details!\");\n      } else {\n        if (this.customer === \"\" || this.receipt_date === \"\" || this.payment_method === \"\" || this.customer_order === \"\" || this.reference_no === \"\" || this.amount_received === \"\") {\n          this.errors.push(\"Some details are missing!\");\n        }\n      }\n\n      this.balance = this.cstOrders[this.selectedOrd].order_total - this.amount_received;\n\n      if (!this.errors.length) {\n        let formData = {\n          receipt_order: this.order_id,\n          receipt_user: this.customerID,\n          received_amount: Number(this.amount_received).toFixed(2),\n          payment_method: this.payment_method,\n          reference_no: this.reference_no,\n          created_at: this.receipt_date,\n          balance: Number(this.balance).toFixed(2)\n        };\n        this.axios.post('api/v1/generate-receipt/', formData).then(response => {\n          this.generated_receipt = response.data;\n          this.$toast.success(\"Receipt Succesfully Added\", {\n            duration: 5000,\n            dismissible: true\n          });\n        }).catch(error => {\n          console.log(error);\n        }).finally(() => {\n          this.payment_status = true;\n          let formData = {\n            first_name: this.order_first_name,\n            last_name: this.order_last_name,\n            email: this.order_email,\n            phone_number: this.order_phone_number,\n            county: this.order_county,\n            city: this.order_city,\n            address: this.order_address,\n            order_total: this.order_order_total,\n            delivery_fee: this.order_delivery_fee,\n            items: this.order_items,\n            paid: this.payment_status,\n            payment_reference: this.reference_no,\n            receipt_no: this.generated_receipt.receipt_no,\n            coupon_applied: this.coupon_applied\n          };\n          this.axios.put(\"/api/v1/orders/\" + this.order_id + \"/\", formData).then(response => {\n            console.log(response);\n          }).catch(error => {\n            console.log(error.message); // console.log(error.response.data);  \n            // console.log(error.response.status);  \n            // console.log(error.response.headers);\n          }).finally(() => {\n            this.axios.get(`/api/v1/coupons/?=${this.order_id}/`).then(response => {\n              this.order_coupon = response.data;\n              this.coupon_code = this.order_coupon[0].coupon_code;\n            }).catch(error => {\n              console.log(error.message);\n            }).finally(() => {\n              let formData = {\n                coupon_amount: this.order_coupon[0].coupon_amount,\n                coupon_order: this.order_coupon[0].coupon_order,\n                status: this.coupon_status\n              };\n              this.axios.put(`/api/v1/coupons-list/${this.coupon_code}/`, formData).then(response => {}).catch(error => {\n                console.log(error.message);\n              }).finally(() => {\n                this.hideLoader();\n                this.customer = \"\";\n                this.customer_order = \"\";\n                this.amount_received = 0;\n                this.receipt_date = \"\";\n                this.payment_method = \"\";\n                this.reference_no = \"\";\n                this.payment_status = false;\n              });\n            });\n          });\n        });\n      }\n    }\n\n  },\n\n  mounted() {\n    this.getAllCustomers();\n    this.options = [];\n\n    for (let i = 0; i < this.customersArray.length; i++) {\n      this.options.push(this.customersArray[i].first_name + \" \" + this.customersArray[i].last_name);\n    }\n  }\n\n};","map":{"version":3,"mappings":"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","names":["ref","reactive","LoadingView","Multiselect","props","components","data","email","customerID","selectedCust","selectedOrd","orders","cstOrders","errors","receipt_date","payment_method","reference_no","amount_received","customer","customer_order","balance","order_id","payment_status","order_first_name","order_last_name","order_email","order_phone_number","order_county","order_city","order_address","order_items","order_order_total","order_delivery_fee","order_coupon","generated_receipt","coupon_code","coupon_status","options","methods","showOrders","$refs","customerSelect","selectedIndex","customersArray","id","axios","get","then","response","i","length","user","paid","push","catch","error","console","log","setOrderID","orderSelect","first_name","last_name","phone_number","county","city","address","order_total","delivery_fee","items","coupon_applied","createReceipt","showLoader","formData","receipt_order","receipt_user","received_amount","Number","toFixed","created_at","post","$toast","success","duration","dismissible","finally","payment_reference","receipt_no","put","message","coupon_amount","coupon_order","status","hideLoader","mounted","getAllCustomers"],"sourceRoot":"","sources":["/home/sammyb/gee_collections/gee_collections_vue/src/views/ReceiptAddView.vue"],"sourcesContent":["<template>\n    <!-- Loading Animation for Printing Invoice -->\n  <LoadingView\n    :loader=\"loader\"\n    :showLoader=\"showLoader\"\n    :hideLoader=\"hideLoader\"\n  />\n\n    <div :style=\"{zIndex: this.loaderIndex}\">\n\n        <!-- Breadcrumb Start -->\n        <div class=\"breadcrumb-wrap\">\n        <div class=\"container-fluid\">\n            <ul class=\"breadcrumb\">\n            <li class=\"breadcrumb-item\"><router-link to=\"/\">Home</router-link></li>\n            <li class=\"breadcrumb-item\"><router-link to=\"/cart\">Receipts</router-link></li>\n            <li class=\"breadcrumb-item active\">New Receipt</li>\n            </ul>\n        </div>\n        </div>\n        <!-- Breadcrumb End -->\n        <!-- Checkout Start -->\n        <div class=\"receipt-add w-full px-16 py-10\">\n            <div class=\"bg-white py-10\">\n                <form action=\"\" @submit.prevent=\"createReceipt\">\n                    <div class=\"flex\">\n                        <div class=\"basis-1/2 px-20\">\n                            <div class=\"flex\">\n                                <div class=\"basis-1/2\">\n                                    <p><strong>Customer :</strong></p>\n                                </div>\n                                <div class=\"basis-1/2\">\n                                    <select name=\"customer\" ref=\"customerSelect\" id=\"selectCustomer\" class=\"form-control\" @change=\"showOrders\" onfocus=\"this.selectedIndex = -1;\" v-model=\"customer\">\n                                        <option value=\"\" disabled=\"true\" selected>--Select Customer--</option>\n                                        <option v-for=\"cust in customersArray\">{{ cust.first_name }} {{ cust.last_name }}</option> \n                                    </select>\n                                </div>\n                            </div>\n                            <div class=\"flex\">\n                                <div class=\"basis-1/2\">\n                                    <p><strong>Payment Method :</strong></p>\n                                </div>\n                                <div class=\"basis-1/2\">\n                                    <select name=\"payment-method\" id=\"\" class=\"form-control\" v-model=\"payment_method\">\n                                        <option value=\"\" disabled=\"true\">--Select Payment Method--</option>\n                                        <option value=\"Cash\">Cash</option>\n                                        <option value=\"Mpesa\">Mpesa</option>\n                                        <option value=\"Cheque\">Cheque</option>\n                                        <option value=\"EFT\">EFT</option>\n                                    </select>\n                                </div>\n                                \n                            </div>\n                            <div class=\"flex\">\n                                <div class=\"basis-1/2\">\n                                    <p><strong>Receipt Date :</strong></p>\n                                </div>\n                                <div class=\"basis-1/2\">\n                                    <input type=\"date\" name=\"\" id=\"\" class=\"form-control\" v-model=\"receipt_date\">\n                                </div>\n                            </div>\n                            <div class=\"col-md-12 notification is-danger\" v-if=\"errors.length\">\n                                <p style=\"color: red\" v-for=\"error in errors\" v-bind:key=\"error\">\n                                    {{ error }}\n                                </p>\n                            </div>\n                            <div class=\"flex\">\n                                <div class=\"basis-1/2\">\n                                    <button type=\"submit\" class=\"save-button rounded w-24 px-3 py-2\">Save</button>\n                                </div>\n                                <div class=\"basis-1/2\">\n                                    <button type=\"reset\" class=\"reset-button rounded w-24 px-3 py-2\">Reset</button>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"basis-1/2 px-20\">\n                            <div class=\"flex\">\n                                <div class=\"basis-1/2\">\n                                    <p><strong>Customer Order:</strong></p>\n                                </div>\n                                <div class=\"basis-1/2\">\n                                    <select name=\"order\" ref=\"orderSelect\" id=\"\" class=\"form-control\" @change=\"setOrderID\" onfocus=\"this.selectedIndex = -1;\" v-model=\"customer_order\">\n                                        <option value=\"\" disabled=\"true\" selected>--Select Order--</option>\n                                        <option v-for=\"ord in cstOrders\">{{ ord.invoice_no }} [{{ord.id}} ({{ ord.order_total }})]</option> \n                                    </select>\n                                </div>\n                            </div>\n                            <div class=\"flex\">\n                                <div class=\"basis-1/2\">\n                                    <p><strong>Reference No:</strong></p>\n                                </div>\n                                <div class=\"basis-1/2\">\n                                <input type=\"text\" class=\"form-control\" v-model=\"reference_no\">\n                                </div>\n                            </div>\n                            <div class=\"flex\">\n                                <div class=\"basis-1/2\">\n                                    <p><strong>Amount Received:</strong></p>\n                                </div>\n                                <div class=\"basis-1/2\">\n                                <input type=\"text\" class=\"form-control\" v-model=\"amount_received\">\n                                </div>\n                            </div>\n                            <div>\n                                <Multiselect\n                                :options=\"options\"\n                                v-model=\"customer\"\n                                @search-change=\"showOrders\"\n                                :searchable=\"true\"\n                                placeholder=\"Select A Customer\"\n                                >   \n                                </Multiselect>\n                            </div>\n                        </div>\n                    </div>\n                </form>\n            </div>\n        </div>\n    </div>\n\n</template>\n\n<script>\nimport {ref, reactive} from \"vue\"\nimport LoadingView from \"@/components/LoadingView.vue\"\nimport Multiselect from 'vue-multiselect'\n\nexport default{\n    props: [\"getAllCustomers\", \"customersArray\", 'showClientOrders','myOrders','loader','showLoader','hideLoader','loaderIndex'],\n    components:{\n        LoadingView,\n        Multiselect\n    },\n    // setup(){\n\n    //     const selectedCustomer = ref(null)\n    //     const state = reactive({\n    //         customer: \"\",\n    //         date: \"\",\n    //         order: \"\",\n    //         reference_no: \"\",\n    //         payment_method: \"\",\n    //         amount: 0,\n    //         orders: [],\n    //         customerOrders: [],\n    //         email: \"\",\n            \n    //     });\n\n    //     const showOrders = ()=>{\n    //        state.email = this.customersArray[selectedCustomer.selectedIndex].email;\n    //        console.log(\"The email is \", state.email)\n    //        console.log(\"The selcted index is \",selectedCustomer.selectedIndex)\n\n    //         // this.axios\n    //         // .get(`api/v1/orders/${user}/`)\n    //         // .then((response) => {\n    //         //     state.orders = response.data;\n    //         //     state.customerOrders = state.orders[selectedCustomer.selectedIndex];\n    //         // })\n    //         // .catch((error) => {\n    //         // console.log(error);\n    //         // });\n    //     }\n    //     return{\n    //         selectedCustomer, showOrders\n    //     }\n    // },\n    data(){\n        return{\n            email: \"\",\n            customerID: \"\",\n            selectedCust: 0,\n            selectedOrd: 0,\n            orders: [],\n            cstOrders: [],\n            errors: [],\n            receipt_date: \"\",\n            payment_method: \"\",\n            reference_no: \"\",\n            amount_received: 0,\n            customer: \"\",\n            customer_order: \"\",\n            balance: 0,\n            order_id: \"\",\n            payment_status: false,\n            order_first_name: \"\",\n            order_last_name: \"\",\n            order_email: \"\",\n            order_phone_number: \"\",\n            order_county: \"\",\n            order_city: \"\",\n            order_address: \"\",\n            order_items: [],\n            order_order_total: 0,\n            order_delivery_fee: 0,\n            order_coupon: [],\n            generated_receipt: [],\n            coupon_code : \"\",\n            coupon_status: \"Activated\",\n            options: []\n        }\n    },\n    methods :{\n        showOrders(){\n            this.cstOrders = [];\n            this.selectedCust = this.$refs.customerSelect.selectedIndex - 1;\n            this.email = this.customersArray[this.selectedCust].email;\n            this.customerID = this.customersArray[this.selectedCust].id;\n    \n            this.axios\n            .get(`api/v1/orders/?=${this.email}/`)\n            .then((response) => {\n                this.orders = response.data;\n                for(let i=0; i<this.orders.length; i++){\n                    if(this.orders[i].user == this.email && this.orders[i].paid == false){\n                        this.cstOrders.push(this.orders[i]);\n                    }\n                }\n            })\n            .catch((error) => {\n            console.log(error);\n            });\n        },\n        setOrderID(){\n            this.order_id = \"\";\n            this.order_first_name = \"\";\n            this.order_last_name = \"\";\n            this.order_email = \"\";\n            this.order_phone_number = \"\";\n            this.order_county = \"\";\n            this.order_city = \"\";\n            this.order_address = \"\";\n            this.order_order_total = 0;\n            this.order_delivery_fee = 0;\n            this.order_items = [];\n            this.payment_status = false;\n            this.selectedOrd = this.$refs.orderSelect.selectedIndex - 1;\n            this.order_id = this.cstOrders[this.selectedOrd].id;\n            this.payment_status = this.cstOrders[this.selectedOrd].paid;\n            this.order_first_name = this.cstOrders[this.selectedOrd].first_name;\n            this.order_last_name = this.cstOrders[this.selectedOrd].last_name;\n            this.order_email = this.cstOrders[this.selectedOrd].email;\n            this.order_phone_number = this.cstOrders[this.selectedOrd].phone_number;\n            this.order_county = this.cstOrders[this.selectedOrd].county;\n            this.order_city = this.cstOrders[this.selectedOrd].city;\n            this.order_address = this.cstOrders[this.selectedOrd].address;\n            this.order_order_total = this.cstOrders[this.selectedOrd].order_total;\n            this.order_delivery_fee = this.cstOrders[this.selectedOrd].delivery_fee;\n            this.order_items = this.cstOrders[this.selectedOrd].items;\n            this.coupon_applied = this.cstOrders[this.selectedOrd].coupon_applied;\n        },\n        createReceipt(){\n            this.showLoader();\n            this.errors = [];\n            if (\n                this.customer === \"\" &&\n                this.receipt_date === \"\" &&\n                this.payment_method === \"\" &&\n                this.customer_order === \"\" &&\n                this.reference_no === \"\" &&\n                this.amount_received === \"\"\n            ) {\n                this.errors.push(\"Please fill in the details!\");\n            } else {\n                if (\n                this.customer === \"\" ||\n                this.receipt_date === \"\" ||\n                this.payment_method === \"\" ||\n                this.customer_order === \"\" ||\n                this.reference_no === \"\" ||\n                this.amount_received === \"\" \n                ) {\n                this.errors.push(\"Some details are missing!\");\n                }\n            }\n            this.balance = this.cstOrders[this.selectedOrd].order_total - this.amount_received;\n            if (!this.errors.length) {\n                let formData = {\n                    receipt_order: this.order_id,\n                    receipt_user: this.customerID,\n                    received_amount: Number(this.amount_received).toFixed(2),\n                    payment_method: this.payment_method,\n                    reference_no: this.reference_no,\n                    created_at: this.receipt_date,\n                    balance: Number(this.balance).toFixed(2)\n                }\n                this.axios\n                .post('api/v1/generate-receipt/', formData)\n                .then((response)=>{\n                    this.generated_receipt = response.data;\n  \n                    this.$toast.success(\"Receipt Succesfully Added\", {\n                    duration: 5000,\n                    dismissible: true,\n                    });\n                })\n                .catch((error)=>{\n                    console.log(error);\n                })\n                .finally(()=>{\n                    this.payment_status = true;\n                    let formData = {\n                        first_name: this.order_first_name,\n                        last_name: this.order_last_name,\n                        email: this.order_email,\n                        phone_number: this.order_phone_number,\n                        county: this.order_county,\n                        city: this.order_city,\n                        address: this.order_address,\n                        order_total: this.order_order_total,\n                        delivery_fee: this.order_delivery_fee,\n                        items: this.order_items,\n                        paid : this.payment_status,\n                        payment_reference : this.reference_no,\n                        receipt_no : this.generated_receipt.receipt_no,\n                        coupon_applied: this.coupon_applied,\n                    }\n                    \n                    this.axios\n                    .put(\"/api/v1/orders/\" + this.order_id + \"/\", formData)\n                    .then((response)=>{\n                        console.log(response);\n                    })\n                    .catch((error)=>{\n                        console.log(error.message);\n                        // console.log(error.response.data);  \n                        // console.log(error.response.status);  \n                        // console.log(error.response.headers);\n                    })\n                    .finally(()=>{\n                        this.axios\n                        .get(`/api/v1/coupons/?=${ this.order_id }/`)\n                        .then((response)=>{\n                            this.order_coupon = response.data;\n                            this.coupon_code = this.order_coupon[0].coupon_code;                          \n                        })\n                        .catch((error)=>{\n                            console.log(error.message);\n                        })\n                        .finally(()=>{\n                            let formData = {\n                                coupon_amount : this.order_coupon[0].coupon_amount,\n                                coupon_order : this.order_coupon[0].coupon_order,\n                                status: this.coupon_status,\n                            }\n                            this.axios\n                            .put(`/api/v1/coupons-list/${this.coupon_code}/`, formData)\n                            .then((response)=>{\n\n                            })\n                            .catch((error)=>{\n                                console.log(error.message);\n                            })\n                            .finally(()=>{\n                                this.hideLoader();\n                                this.customer = \"\";\n                                this.customer_order = \"\";\n                                this.amount_received = 0;\n                                this.receipt_date = \"\";\n                                this.payment_method = \"\";\n                                this.reference_no = \"\";\n                                this.payment_status = false;\n                            })\n                        })\n                    \n                    })\n                    \n                })\n            }\n\n        }\n\n    },\n    mounted(){\n        this.getAllCustomers();\n        this.options = [];\n        for(let i=0; i<this.customersArray.length; i++){\n            this.options.push(this.customersArray[i].first_name+ \" \"+this.customersArray[i].last_name);\n        }\n    }\n}\n\n</script>\n\n<style scoped>\n .save-button{\n    background-color: #ff6f61;\n    color: white;\n }\n .reset-button{\n    border: 1px solid;\n    border-color: #ff6f61;\n }\n .save-button:hover{\n    border: 1px solid;\n    background-color: black;\n    color: white;\n }\n .reset-button:hover{\n    border: 1px solid;\n    background-color: #ff6f61;\n    color: white;\n }\n</style>"]},"metadata":{},"sourceType":"module"}