{"ast":null,"code":"import Modal from \"@/components/Modal.vue\";\nexport default {\n  props: [\"cartGrandTotal\", \"cartItemTotal\", \"cartSubTotal\", \"shippingCost\", \"cartTotalUSD\"],\n  el: \"#selector\",\n  components: {\n    Modal\n  },\n\n  data() {\n    return {\n      cart: {\n        cartItems: []\n      },\n      id: \"\",\n      first_name: \"\",\n      last_name: \"\",\n      email: \"\",\n      phone_number: \"\",\n      address: \"\",\n      county: \"\",\n      city: \"\",\n      town: \"\",\n      gender: \"\",\n      errors: [],\n      lipaNaMpesa: false,\n      paymentConfirm: false,\n      checked: false,\n      errors: [],\n      payment_number: \"\",\n      transaction_id: \"\",\n      isModalVisible: false,\n      mpesaRefs: [],\n      mpesaRef: \"\",\n      is_paid: false,\n      payment_ref: \"\",\n      watcherMsg: [],\n      rfStyle: null,\n      bWidth: null,\n      payment_number2: \"\",\n      pStyle: null,\n      p2Style: null,\n      isAuthenticated: false,\n      deliveryOption: false,\n      unknownVal: \"\"\n    };\n  },\n\n  watch: {\n    mpesaRef(value) {\n      this.mpesaRef = value;\n      this.validatePaymentRef(value);\n    },\n\n    payment_number2(value) {\n      this.payment_number2 = value;\n      this.validatePhoneNumber(value);\n    },\n\n    payment_number(value) {\n      this.payment_number = value;\n      this.validatePhoneNumber2(value);\n    }\n\n  },\n  computed: {\n    setShippingCost() {\n      let shipCost = 0;\n\n      if (this.cartSubTotal == 0 || this.deliveryOption == false) {\n        this.shipCost = 0;\n      } else {\n        if (this.town == \"Bondo\" || this.town == \"Siaya\" || this.town == \"Nairobi\" || this.town == \"Ugunja\") {\n          this.shipCost = 100;\n          console.log(\"The shipping cost is \", this.shipCost);\n        } else {\n          if (this.town == \"Busia\" || this.town == \"Kiambu\" || this.town == \"Kikuyu\" || this.town == \"Kisumu\" || this.town == \"Luanda\" || this.town == \"Thika\") {\n            this.shipCost = 200;\n          } else {\n            if (this.town == \"Kakamega\") {\n              this.shipCost = 250;\n            } else {\n              if (this.town == \"Ahero\" || this.town == \"Bungoma\" || this.town == \"Machakos\" || this.town == \"Mumias\" || this.town == \"Naivasha\" || this.town == \"Nakuru\") {\n                this.shipCost = 300;\n              } else {\n                if (this.town == \"Kericho\" || this.town == \"Migori\" || this.town == \"Kitale\") {\n                  this.shipCost = 400;\n                } else {\n                  if (this.town == \"Eldoret\" || this.town == \"Embu\" || this.town == \"Kisii\" || this.town == \"Nyamira\") {\n                    this.shipCost = 500;\n                  } else {\n                    if (this.town == \"Malindi\" || this.town == \"Mombasa\" || this.town == \"Mtwapa\" || this.town == \"Ukunda\") {\n                      this.shipCost = 600;\n                    } else {\n                      this.shipCost = 0;\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n\n      return this.shipCost;\n    },\n\n    checkoutTotal() {\n      return this.cartSubTotal + this.setShippingCost;\n    }\n\n  },\n  methods: {\n    validatePaymentRef(value) {\n      if (value.length == \"\") {\n        this.watcherMsg[\"mpesaRef\"] = \"\";\n        this.rfStyle = \"\";\n        this.bWidth = 1;\n      } else {\n        if (/^[A-Z0-9]$/.test(value) && value.length > 9) {\n          this.rfStyle = \"green\";\n          this.watcherMsg[\"mpesaRef\"] = \"\";\n          this.bWidth = 2;\n        } else {\n          this.rfStyle = \"red\";\n          this.watcherMsg[\"mpesaRef\"] = \"Incomplete Reference Number\";\n          this.bWidth = 2;\n        }\n      }\n    },\n\n    validatePhoneNumber2(value) {\n      if (value == \"\") {\n        this.p2Style = \"\";\n        this.watcherMsg[\"payment_number\"] = \"\";\n      } else {\n        if (/^(?:254)?((?:(?:7(?:(?:[01249][0-9])|(?:5[789])|(?:6[89])))|(?:1(?:[1][0-5])))[0-9]{6})$/.test(value) || /^(?:254|\\+254|0)?((?:(?:7(?:(?:3[0-9])|(?:5[0-6])|(8[5-9])))|(?:1(?:[0][0-2])))[0-9]{6})$/.test(value)) {\n          this.p2Style = \"green\";\n          this.watcherMsg[\"payment_number\"] = \"\";\n          this.bWidth = 2;\n        } else {\n          this.p2Style = \"red\";\n          this.watcherMsg[\"payment_number\"] = \"Invalid Phone Number\";\n          this.bWidth = 2;\n        }\n      }\n    },\n\n    validatePhoneNumber(value) {\n      if (value == this.payment_number) {\n        this.pStyle = \"green\";\n        this.watcherMsg[\"payment_number2\"] = \"\";\n      } else {\n        this.pStyle = \"red\";\n        this.watcherMsg[\"payment_number2\"] = \"Invalid Phone Number\";\n      }\n    },\n\n    getProfileDetails() {\n      this.axios.get(\"/api/v1/users/me/\").then(response => {\n        this.phone_number = response.data.phone_number;\n        this.email = response.data.email;\n        this.id = response.data.id;\n        this.first_name = response.data.first_name;\n        this.last_name = response.data.last_name;\n        this.gender = response.data.gender;\n        this.city = response.data.city;\n        this.county = response.data.county;\n        this.address = response.data.address;\n      }).catch(error => {});\n    },\n\n    registerCallbackUrl() {\n      this.axios.get(\"/api/v1/c2b/register\").then(response => {\n        console.log(response.data);\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n\n    async payViaMpesa() {\n      this.errors = [];\n\n      if (this.payment_number === \"\") {\n        this.errors.push(\"Please enter phone number\");\n        this.$toast.error(\"Invalid phone number\", {\n          duration: 3000\n        });\n      }\n\n      if (!this.errors.length) {\n        let formData = {\n          payment_number: this.payment_number,\n          first_name: this.first_name,\n          orderTotal: this.checkoutTotal\n        };\n        this.axios.post(\"/api/v1/online/lipa/\", formData).then(response => {\n          console.log(response.data);\n          this.paymentConfirm = true;\n        }).catch(error => {\n          console.log(error);\n        }).finally(() => {});\n      }\n    },\n\n    getMpesaPayments() {\n      this.mpesaRefs = [];\n      this.axios.get(\"api/v1/mpesa-payments/\").then(response => {\n        for (let i = 0; i < response.data.length; i++) {\n          let trans_id = response.data[i].transaction_id;\n          this.mpesaRefs.push(trans_id);\n        }\n\n        console.log(this.mpesaRefs);\n        this.isModalVisible = true;\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n\n    confirmPayment() {\n      if (this.mpesaRefs.includes(this.mpesaRef)) {\n        this.is_paid = true;\n        this.payment_ref = this.mpesaRef;\n        this.$toast.success(\"Payment Confirmation Succesful\", {\n          duration: 3000\n        });\n        this.placeOrder();\n      } else {\n        this.$toast.error(\"Invalid Reference Number\", {\n          duration: 3000\n        });\n      }\n    },\n\n    placeOrder() {\n      const items = [];\n\n      for (let i = 0; i < this.cart.cartItems.length; i++) {\n        const item = this.cart.cartItems[i];\n        const obj = {\n          product: item.items.id,\n          quantity: item.quantity,\n          price: item.items.price * item.quantity\n        };\n        items.push(obj);\n      }\n\n      let formData = {\n        first_name: this.first_name,\n        last_name: this.last_name,\n        address: this.address,\n        county: this.county,\n        city: this.city,\n        phone_number: this.phone_number,\n        email: this.email,\n        items: items,\n        order_total: this.cartSubTotal,\n        payment_reference: this.payment_ref,\n        paid: this.is_paid,\n        delivery_fee: this.setShippingCost\n      };\n      console.log(formData);\n      this.axios.post(\"/api/v1/checkout/\", formData).then(response => {\n        this.$store.commit(\"clearCart\");\n        this.$toast.success(\"Order succesfully placed\");\n        this.$router.push(\"/\");\n        this.$store.commit(\"reloadingPage\");\n        this.$router.push(\"/\");\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n\n    requestDelivery() {\n      this.deliveryOption = !this.deliveryOption;\n\n      if (this.deliveryOption == false) {\n        this.town = \"\";\n      }\n    },\n\n    showLipaNaMpesa() {\n      this.lipaNaMpesa = !this.lipaNaMpesa;\n    },\n\n    showShippingDetails() {\n      this.checked = !this.checked;\n      console.log(this.checked);\n    },\n\n    closeModal() {\n      this.isModalVisible = false;\n    },\n\n    mountPaypalButton() {},\n\n    scrollToTop() {\n      window.scrollTo({\n        top: 0,\n        behavior: \"smooth\"\n      });\n    }\n\n  },\n\n  beforeMount() {\n    this.getProfileDetails();\n    this.cart = this.$store.state.cart;\n    this.isAuthenticated = this.$store.state.isAuthenticated;\n  },\n\n  mounted() {\n    this.registerCallbackUrl();\n\n    if (!this.isAuthenticated) {\n      this.$toast.error(\"You need to create an account before proceeding to checkout\");\n    }\n\n    paypal.Buttons({\n      //Styling the paypal button\n      style: {\n        color: \"blue\",\n        shape: \"pill\",\n        label: \"pay\",\n        height: 40\n      },\n      // Sets up the transaction when a payment button is clicked\n      createOrder: (data, actions) => {\n        return actions.order.create({\n          purchase_units: [{\n            amount: {\n              // value: this.cartTotalUSD // Can also reference a variable or function\n              value: 0.01\n            }\n          }]\n        });\n      },\n      // Finalize the transaction after payer approval\n      onApprove: (data, actions) => {\n        const my_action = actions.order.capture().then(function (orderData) {\n          // Successful capture! For dev/demo purposes:\n          console.log(\"Capture result\", orderData, JSON.stringify(orderData, null, 2));\n          this.transaction_id = orderData.purchase_units[0].payments.captures[0].id;\n          console.log(\"the transaction_id is:\", this.transaction_id);\n          const transaction = orderData.purchase_units[0].payments.captures[0];\n          alert(`Transaction ${transaction.status}: ${transaction.id}\\n\\nSee console for all available details`); // this.placeOrder();\n          // When ready to go live, remove the alert and show a success message within this page. For example:\n          // const element = document.getElementById('paypal-button-container');\n          // element.innerHTML = '<h3>Thank you for your payment!</h3>';\n          // Or go to another URL:  actions.redirect('thank_you.html');\n        });\n        return my_action;\n      }\n    }).render(\"#paypal-button-container\");\n  }\n\n};","map":{"version":3,"mappings":"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","names":["Modal","props","el","components","data","cart","cartItems","id","first_name","last_name","email","phone_number","address","county","city","town","gender","errors","lipaNaMpesa","paymentConfirm","checked","payment_number","transaction_id","isModalVisible","mpesaRefs","mpesaRef","is_paid","payment_ref","watcherMsg","rfStyle","bWidth","payment_number2","pStyle","p2Style","isAuthenticated","deliveryOption","unknownVal","watch","value","validatePaymentRef","validatePhoneNumber","validatePhoneNumber2","computed","setShippingCost","shipCost","cartSubTotal","console","log","checkoutTotal","methods","length","test","getProfileDetails","axios","get","then","response","catch","error","registerCallbackUrl","payViaMpesa","push","$toast","duration","formData","orderTotal","post","finally","getMpesaPayments","i","trans_id","confirmPayment","includes","success","placeOrder","items","item","obj","product","quantity","price","order_total","payment_reference","paid","delivery_fee","$store","commit","$router","requestDelivery","showLipaNaMpesa","showShippingDetails","closeModal","mountPaypalButton","scrollToTop","window","scrollTo","top","behavior","beforeMount","state","mounted","paypal","Buttons","style","color","shape","label","height","createOrder","actions","order","create","purchase_units","amount","onApprove","my_action","capture","orderData","JSON","stringify","payments","captures","transaction","alert","status","render"],"sourceRoot":"","sources":["/home/sammyb/gee_collections/gee_collections_vue/src/views/CheckoutView.vue"],"sourcesContent":["<template>\n  <div class=\"checkout\">\n    <!-- Breadcrumb Start -->\n    <div class=\"breadcrumb-wrap\">\n      <div class=\"container-fluid\">\n        <ul class=\"breadcrumb\">\n          <li class=\"breadcrumb-item\"><router-link to=\"/\">Home</router-link></li>\n          <li class=\"breadcrumb-item\"><router-link to=\"/cart\">Cart</router-link></li>\n          <li class=\"breadcrumb-item active\">Checkout</li>\n        </ul>\n      </div>\n    </div>\n    <!-- Breadcrumb End -->\n\n    <!-- Checkout Start -->\n    <div class=\"checkout\">\n      <div class=\"container-fluid\">\n        <form action=\"\" @submit.prevent=\"placeOrder\">\n          <div class=\"row\">\n            <div class=\"col-lg-8\">\n              <div class=\"checkout-inner\">\n                <div class=\"billing-address\">\n                  <h2>Billing Address</h2>\n                  <div class=\"row\">\n                    <div class=\"col-md-6\">\n                      <label>First Name</label>\n                      <input\n                        class=\"form-control\"\n                        type=\"text\"\n                        placeholder=\"First Name\"\n                        v-model=\"first_name\"\n                      />\n                    </div>\n                    <div class=\"col-md-6\">\n                      <label>Last Name</label>\n                      <input\n                        class=\"form-control\"\n                        type=\"text\"\n                        placeholder=\"Last Name\"\n                        v-model=\"last_name\"\n                      />\n                    </div>\n                    <div class=\"col-md-6\">\n                      <label>E-mail</label>\n                      <input\n                        class=\"form-control\"\n                        type=\"email\"\n                        placeholder=\"Email\"\n                        v-model=\"email\"\n                        disabled=\"true\"\n                      />\n                    </div>\n                    <div class=\"col-md-6\">\n                      <label>Mobile No</label>\n                      <input\n                        class=\"form-control\"\n                        type=\"text\"\n                        placeholder=\"Mobile\"\n                        v-model=\"phone_number\"\n                      />\n                    </div>\n                    <div class=\"col-md-6\">\n                      <label>Gender</label>\n                      <select name=\"gender\" class=\"form-control\" v-model=\"gender\">\n                        <option value=\"\" disabled=\"true\">--Select your Gender--</option>\n                        <option>Male</option>\n                        <option>Female</option>\n                        <option>Other</option>\n                      </select>\n                    </div>\n                    <div class=\"col-md-6\">\n                      <label>Address</label>\n                      <input\n                        class=\"form-control\"\n                        type=\"text\"\n                        placeholder=\"Address\"\n                        v-model=\"address\"\n                      />\n                    </div>\n                    <div class=\"col-md-6\">\n                      <label>City</label>\n                      <select name=\"city\" class=\"form-control\" v-model=\"city\">\n                        <option value=\"\" disabled=\"true\">--Select your City--</option>\n                        <option>Nairobi</option>\n                        <option>Kisumu</option>\n                        <option>Mombasa</option>\n                        <option>Nakuru</option>\n                      </select>\n                    </div>\n                    <div class=\"col-md-6\">\n                      <label>County</label>\n                      <select name=\"county\" class=\"form-control\" v-model=\"county\">\n                        <option value=\"\" disabled=\"true\">--Select your County--</option>\n                        <option>Siaya</option>\n                        <option>Kisumu</option>\n                        <option>Nairobi</option>\n                        <option>Mombasa</option>\n                      </select>\n                    </div>\n                    <div class=\"col-md-12\">\n                      <div class=\"custom-control custom-checkbox\">\n                        <input\n                          type=\"checkbox\"\n                          class=\"custom-control-input\"\n                          id=\"newaccount\"\n                          @click=\"requestDelivery()\"\n                        />\n                        <label class=\"custom-control-label\" for=\"newaccount\"\n                          >Select if you would wish for the items to be delivered</label\n                        >\n                        <div class=\"delivery-address\" v-if=\"deliveryOption\">\n                          <br /><br />\n                          <h5>Delivery Address</h5>\n                          <div class=\"row\">\n                            <div class=\"col-md-6\">\n                              <label>Choose the delivery town</label>\n                              <select name=\"town\" class=\"form-control\" v-model=\"town\">\n                                <option value=\"\" disabled=\"true\">\n                                  --Select your Town--\n                                </option>\n                                <option>Ahero</option>\n                                <option>Bondo</option>\n                                <option>Bungoma</option>\n                                <option>Busia</option>\n                                <option>Eldoret</option>\n                                <option>Embu</option>\n                                <option>Kakamega</option>\n                                <option>Kericho</option>\n                                <option>Kiambu</option>\n                                <option>Kikuyu</option>\n                                <option>Kisii</option>\n                                <option>Kisumu</option>\n                                <option>Kitale</option>\n                                <option>Luanda</option>\n                                <option>Machakos</option>\n                                <option>Malindi</option>\n                                <option>Migori</option>\n                                <option>Mombasa</option>\n                                <option>Mtwapa</option>\n                                <option>Mumias</option>\n                                <option>Nairobi</option>\n                                <option>Naivasha</option>\n                                <option>Nakuru</option>\n                                <option>Nyamira</option>\n                                <option>Siaya</option>\n                                <option>Thika</option>\n                                <option>Ugunja</option>\n                                <option>Ukunda</option>\n                              </select>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                    <div class=\"col-md-12\">\n                      <div class=\"custom-control custom-checkbox\">\n                        <input\n                          type=\"checkbox\"\n                          class=\"custom-control-input\"\n                          id=\"shipto\"\n                          @click=\"showShippingDetails\"\n                        />\n                        <label class=\"custom-control-label\" for=\"shipto\"\n                          >Ship to different address</label\n                        >\n                        <div class=\"shipping-address\" v-if=\"checked\">\n                          <h2>Shipping Address</h2>\n                          <div class=\"row\">\n                            <div class=\"col-md-6\">\n                              <label>First Name</label>\n                              <input\n                                class=\"form-control\"\n                                type=\"text\"\n                                placeholder=\"First Name\"\n                              />\n                            </div>\n                            <div class=\"col-md-6\">\n                              <label>Last Name</label>\n                              <input\n                                class=\"form-control\"\n                                type=\"text\"\n                                placeholder=\"Last Name\"\n                              />\n                            </div>\n                            <div class=\"col-md-6\">\n                              <label>E-mail</label>\n                              <input\n                                class=\"form-control\"\n                                type=\"text\"\n                                placeholder=\"E-mail\"\n                              />\n                            </div>\n                            <div class=\"col-md-6\">\n                              <label>Mobile No</label>\n                              <input\n                                class=\"form-control\"\n                                type=\"text\"\n                                placeholder=\"Mobile No\"\n                              />\n                            </div>\n                            <div class=\"col-md-12\">\n                              <label>Address</label>\n                              <input\n                                class=\"form-control\"\n                                type=\"text\"\n                                placeholder=\"Address\"\n                              />\n                            </div>\n                            <div class=\"col-md-6\">\n                              <label>Country</label>\n                              <select class=\"custom-select\">\n                                <option selected>Kenya</option>\n                                <option>Tanzania</option>\n                                <option>Uganda</option>\n                                <option>Rwanda</option>\n                              </select>\n                            </div>\n                            <div class=\"col-md-6\">\n                              <label>City</label>\n                              <input\n                                class=\"form-control\"\n                                type=\"text\"\n                                placeholder=\"City\"\n                              />\n                            </div>\n                            <div class=\"col-md-6\">\n                              <label>County</label>\n                              <input\n                                class=\"form-control\"\n                                type=\"text\"\n                                placeholder=\"County\"\n                              />\n                            </div>\n                            <div class=\"col-md-6\">\n                              <label>ZIP Code</label>\n                              <input\n                                class=\"form-control\"\n                                type=\"text\"\n                                placeholder=\"ZIP Code\"\n                              />\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class=\"col-lg-4\">\n              <div class=\"checkout-inner\">\n                <div class=\"checkout-summary\">\n                  <h1>Cart Total</h1>\n                  <p class=\"sub-total\">\n                    Sub Total<span>ksh. {{ Number(cartSubTotal).toLocaleString() }}</span>\n                  </p>\n                  <!-- <p class=\"ship-cost\">Shipping Cost<span>ksh. {{Number(shippingCost).toLocaleString()}}</span></p> -->\n                  <p class=\"ship-cost\">\n                    Delivery Fee<span\n                      >ksh. {{ Number(setShippingCost).toLocaleString() }}</span\n                    >\n                  </p>\n                  <!-- <h2>Grand Total<span>{{Number(cartGrandTotal).toLocaleString()}}</span></h2> -->\n                  <h2>\n                    Grand Total<span>{{ Number(checkoutTotal).toLocaleString() }}</span>\n                  </h2>\n                </div>\n\n                <div class=\"checkout-payment\">\n                  <h1>Payment Methods</h1>\n                  <button type=\"button\" class=\"lipanampesa\" @click=\"showLipaNaMpesa\">\n                    Lipa Na Mpesa\n                  </button>\n                  <div v-if=\"lipaNaMpesa\">\n                    <p>\n                      To proceed to Lipa Na Mpesa, please enter the phone number you would\n                      like to make the payment with.\n                    </p>\n                    <label for=\"\">Phone Number:</label>\n                    <input\n                      type=\"text\"\n                      class=\"form-control\"\n                      placeholder=\"e.g 2547XXXXXXXX\"\n                      v-model=\"payment_number\"\n                      :style=\"{ borderColor: p2Style, borderWidth: bWidth + 'px' }\"\n                    />\n                    <span\n                      v-if=\"watcherMsg.payment_number\"\n                      :style=\"{ color: p2Style, fontSize: 10 + 'px' }\"\n                      >{{ watcherMsg.payment_number }}</span\n                    >\n                    <div class=\"col-md-12 notification is-danger\" v-if=\"errors.length\">\n                      <p style=\"color: red\" v-for=\"error in errors\" v-bind:key=\"error\">\n                        {{ error }}\n                      </p>\n                    </div>\n                    <button type=\"button\" class=\"procPayBtn\" @click=\"payViaMpesa\">\n                      Proceed to Pay\n                    </button>\n                    <p v-if=\"paymentConfirm\">\n                      An mpesa prompt has been sent to the number entered above,enter your\n                      mpesa PIN then proceed to payment confirmation\n                    </p>\n                    <button\n                      type=\"button\"\n                      class=\"procPayBtn\"\n                      @click=\"getMpesaPayments\"\n                      v-if=\"paymentConfirm\"\n                    >\n                      Confirm Payment\n                    </button>\n                  </div>\n\n                  <!-- MODAL component for confirming payment -->\n                  <Modal v-show=\"isModalVisible\" @close=\"closeModal\">\n                    <template v-slot:header> M-Pesa Payment Confirmation </template>\n\n                    <template v-slot:body>\n                      <div>\n                        <p>\n                          Please confirm the details of your payments to succesfully place\n                          your order\n                        </p>\n                        <label for=\"\">Phone Number:</label>\n                        <input\n                          type=\"text\"\n                          class=\"form-control\"\n                          placeholder=\"e.g 2547XXXXXXXX\"\n                          :style=\"{ borderColor: pStyle, borderWidth: bWidth + 'px' }\"\n                        />\n                        <span\n                          v-if=\"watcherMsg.payment_number2\"\n                          :style=\"{ color: pStyle, fontSize: 10 + 'px' }\"\n                          >{{ watcherMsg.payment_number2 }}</span\n                        >\n                        <label for=\"\">Reference Number:</label>\n                        <input\n                          type=\"text\"\n                          class=\"form-control\"\n                          placeholder=\"e.g QRYU0U***P1\"\n                          v-model=\"mpesaRef\"\n                          :style=\"{ borderColor: rfStyle, borderWidth: bWidth + 'px' }\"\n                        />\n                        <span\n                          v-if=\"watcherMsg.mpesaRef\"\n                          :style=\"{ color: rfStyle, fontSize: 10 + 'px' }\"\n                          >{{ watcherMsg.mpesaRef }}</span\n                        >\n                        <button type=\"button\" class=\"procPayBtn\" @click=\"confirmPayment\">\n                          Confirm Payment\n                        </button>\n                      </div>\n                    </template>\n\n                    <template v-slot:footer>\n                      Thank you for doing business with us.\n                    </template>\n                  </Modal>\n                  <div id=\"paypal-button-container\"></div>\n                  <div ref=\"card\"></div>\n                  <div class=\"checkout-btn\">\n                    <button>Place Order</button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </form>\n      </div>\n    </div>\n    <!-- Checkout End -->\n  </div>\n</template>\n\n<script>\nimport Modal from \"@/components/Modal.vue\";\nexport default {\n  props: [\n    \"cartGrandTotal\",\n    \"cartItemTotal\",\n    \"cartSubTotal\",\n    \"shippingCost\",\n    \"cartTotalUSD\",\n  ],\n  el: \"#selector\",\n  components: {\n    Modal,\n  },\n  data() {\n    return {\n      cart: {\n        cartItems: [],\n      },\n      id: \"\",\n      first_name: \"\",\n      last_name: \"\",\n      email: \"\",\n      phone_number: \"\",\n      address: \"\",\n      county: \"\",\n      city: \"\",\n      town: \"\",\n      gender: \"\",\n      errors: [],\n      lipaNaMpesa: false,\n      paymentConfirm: false,\n      checked: false,\n      errors: [],\n      payment_number: \"\",\n      transaction_id: \"\",\n      isModalVisible: false,\n      mpesaRefs: [],\n      mpesaRef: \"\",\n      is_paid: false,\n      payment_ref: \"\",\n      watcherMsg: [],\n      rfStyle: null,\n      bWidth: null,\n      payment_number2: \"\",\n      pStyle: null,\n      p2Style: null,\n      isAuthenticated: false,\n      deliveryOption: false,\n      unknownVal: \"\",\n    };\n  },\n  watch: {\n    mpesaRef(value) {\n      this.mpesaRef = value;\n      this.validatePaymentRef(value);\n    },\n    payment_number2(value) {\n      this.payment_number2 = value;\n      this.validatePhoneNumber(value);\n    },\n    payment_number(value) {\n      this.payment_number = value;\n      this.validatePhoneNumber2(value);\n    },\n  },\n  computed: {\n    setShippingCost() {\n      let shipCost = 0;\n      if (this.cartSubTotal == 0 || this.deliveryOption == false) {\n        this.shipCost = 0;\n      } else {\n        if (\n          this.town == \"Bondo\" ||\n          this.town == \"Siaya\" ||\n          this.town == \"Nairobi\" ||\n          this.town == \"Ugunja\"\n        ) {\n          this.shipCost = 100;\n          console.log(\"The shipping cost is \", this.shipCost);\n        } else {\n          if (\n            this.town == \"Busia\" ||\n            this.town == \"Kiambu\" ||\n            this.town == \"Kikuyu\" ||\n            this.town == \"Kisumu\" ||\n            this.town == \"Luanda\" ||\n            this.town == \"Thika\"\n          ) {\n            this.shipCost = 200;\n          } else {\n            if (this.town == \"Kakamega\") {\n              this.shipCost = 250;\n            } else {\n              if (\n                this.town == \"Ahero\" ||\n                this.town == \"Bungoma\" ||\n                this.town == \"Machakos\" ||\n                this.town == \"Mumias\" ||\n                this.town == \"Naivasha\" ||\n                this.town == \"Nakuru\"\n              ) {\n                this.shipCost = 300;\n              } else {\n                if (\n                  this.town == \"Kericho\" ||\n                  this.town == \"Migori\" ||\n                  this.town == \"Kitale\"\n                ) {\n                  this.shipCost = 400;\n                } else {\n                  if (\n                    this.town == \"Eldoret\" ||\n                    this.town == \"Embu\" ||\n                    this.town == \"Kisii\" ||\n                    this.town == \"Nyamira\"\n                  ) {\n                    this.shipCost = 500;\n                  } else {\n                    if (\n                      this.town == \"Malindi\" ||\n                      this.town == \"Mombasa\" ||\n                      this.town == \"Mtwapa\" ||\n                      this.town == \"Ukunda\"\n                    ) {\n                      this.shipCost = 600;\n                    } else {\n                      this.shipCost = 0;\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n      return this.shipCost;\n    },\n    checkoutTotal() {\n      return this.cartSubTotal + this.setShippingCost;\n    },\n  },\n  methods: {\n    validatePaymentRef(value) {\n      if (value.length == \"\") {\n        this.watcherMsg[\"mpesaRef\"] = \"\";\n        this.rfStyle = \"\";\n        this.bWidth = 1;\n      } else {\n        if (/^[A-Z0-9]$/.test(value) && value.length > 9) {\n          this.rfStyle = \"green\";\n          this.watcherMsg[\"mpesaRef\"] = \"\";\n          this.bWidth = 2;\n        } else {\n          this.rfStyle = \"red\";\n          this.watcherMsg[\"mpesaRef\"] = \"Incomplete Reference Number\";\n          this.bWidth = 2;\n        }\n      }\n    },\n    validatePhoneNumber2(value) {\n      if (value == \"\") {\n        this.p2Style = \"\";\n        this.watcherMsg[\"payment_number\"] = \"\";\n      } else {\n        if (\n          /^(?:254)?((?:(?:7(?:(?:[01249][0-9])|(?:5[789])|(?:6[89])))|(?:1(?:[1][0-5])))[0-9]{6})$/.test(\n            value\n          ) ||\n          /^(?:254|\\+254|0)?((?:(?:7(?:(?:3[0-9])|(?:5[0-6])|(8[5-9])))|(?:1(?:[0][0-2])))[0-9]{6})$/.test(\n            value\n          )\n        ) {\n          this.p2Style = \"green\";\n          this.watcherMsg[\"payment_number\"] = \"\";\n          this.bWidth = 2;\n        } else {\n          this.p2Style = \"red\";\n          this.watcherMsg[\"payment_number\"] = \"Invalid Phone Number\";\n          this.bWidth = 2;\n        }\n      }\n    },\n    validatePhoneNumber(value) {\n      if (value == this.payment_number) {\n        this.pStyle = \"green\";\n        this.watcherMsg[\"payment_number2\"] = \"\";\n      } else {\n        this.pStyle = \"red\";\n        this.watcherMsg[\"payment_number2\"] = \"Invalid Phone Number\";\n      }\n    },\n    getProfileDetails() {\n      this.axios\n        .get(\"/api/v1/users/me/\")\n        .then((response) => {\n          this.phone_number = response.data.phone_number;\n          this.email = response.data.email;\n          this.id = response.data.id;\n          this.first_name = response.data.first_name;\n          this.last_name = response.data.last_name;\n          this.gender = response.data.gender;\n          this.city = response.data.city;\n          this.county = response.data.county;\n          this.address = response.data.address;\n        })\n        .catch((error) => {});\n    },\n    registerCallbackUrl() {\n      this.axios\n        .get(\"/api/v1/c2b/register\")\n        .then((response) => {\n          console.log(response.data);\n        })\n        .catch((error) => {\n          console.log(error);\n        });\n    },\n    async payViaMpesa() {\n      this.errors = [];\n      if (this.payment_number === \"\") {\n        this.errors.push(\"Please enter phone number\");\n        this.$toast.error(\"Invalid phone number\", {\n          duration: 3000,\n        });\n      }\n      if (!this.errors.length) {\n        let formData = {\n          payment_number: this.payment_number,\n          first_name: this.first_name,\n          orderTotal: this.checkoutTotal,\n        };\n        this.axios\n          .post(\"/api/v1/online/lipa/\", formData)\n          .then((response) => {\n            console.log(response.data);\n            this.paymentConfirm = true;\n          })\n          .catch((error) => {\n            console.log(error);\n          })\n          .finally(() => {});\n      }\n    },\n    getMpesaPayments() {\n      this.mpesaRefs = [];\n      this.axios\n        .get(\"api/v1/mpesa-payments/\")\n        .then((response) => {\n          for (let i = 0; i < response.data.length; i++) {\n            let trans_id = response.data[i].transaction_id;\n            this.mpesaRefs.push(trans_id);\n          }\n          console.log(this.mpesaRefs);\n          this.isModalVisible = true;\n        })\n        .catch((error) => {\n          console.log(error);\n        });\n    },\n    confirmPayment() {\n      if (this.mpesaRefs.includes(this.mpesaRef)) {\n        this.is_paid = true;\n        this.payment_ref = this.mpesaRef;\n        this.$toast.success(\"Payment Confirmation Succesful\", {\n          duration: 3000,\n        });\n        this.placeOrder();\n      } else {\n        this.$toast.error(\"Invalid Reference Number\", {\n          duration: 3000,\n        });\n      }\n    },\n    placeOrder() {\n      const items = [];\n      for (let i = 0; i < this.cart.cartItems.length; i++) {\n        const item = this.cart.cartItems[i];\n        const obj = {\n          product: item.items.id,\n          quantity: item.quantity,\n          price: item.items.price * item.quantity,\n        };\n        items.push(obj);\n      }\n      let formData = {\n        first_name: this.first_name,\n        last_name: this.last_name,\n        address: this.address,\n        county: this.county,\n        city: this.city,\n        phone_number: this.phone_number,\n        email: this.email,\n        items: items,\n        order_total: this.cartSubTotal,\n        payment_reference: this.payment_ref,\n        paid: this.is_paid,\n        delivery_fee: this.setShippingCost,\n      };\n      console.log(formData);\n      this.axios\n        .post(\"/api/v1/checkout/\", formData)\n        .then((response) => {\n          this.$store.commit(\"clearCart\");\n          this.$toast.success(\"Order succesfully placed\");\n          this.$router.push(\"/\");\n          this.$store.commit(\"reloadingPage\");\n          this.$router.push(\"/\");\n        })\n        .catch((error) => {\n          console.log(error);\n        });\n    },\n    requestDelivery() {\n      this.deliveryOption = !this.deliveryOption;\n      if (this.deliveryOption == false) {\n        this.town = \"\";\n      }\n    },\n    showLipaNaMpesa() {\n      this.lipaNaMpesa = !this.lipaNaMpesa;\n    },\n    showShippingDetails() {\n      this.checked = !this.checked;\n      console.log(this.checked);\n    },\n    closeModal() {\n      this.isModalVisible = false;\n    },\n    mountPaypalButton() {},\n    scrollToTop() {\n      window.scrollTo({ top: 0, behavior: \"smooth\" });\n    },\n  },\n  beforeMount() {\n    this.getProfileDetails();\n    this.cart = this.$store.state.cart;\n    this.isAuthenticated = this.$store.state.isAuthenticated;\n  },\n  mounted() {\n    this.registerCallbackUrl();\n    if (!this.isAuthenticated) {\n      this.$toast.error(\"You need to create an account before proceeding to checkout\");\n    }\n    paypal\n      .Buttons({\n        //Styling the paypal button\n        style: {\n          color: \"blue\",\n          shape: \"pill\",\n          label: \"pay\",\n          height: 40,\n        },\n        // Sets up the transaction when a payment button is clicked\n        createOrder: (data, actions) => {\n          return actions.order.create({\n            purchase_units: [\n              {\n                amount: {\n                  // value: this.cartTotalUSD // Can also reference a variable or function\n                  value: 0.01,\n                },\n              },\n            ],\n          });\n        },\n        // Finalize the transaction after payer approval\n        onApprove: (data, actions) => {\n          const my_action = actions.order.capture().then(function (orderData) {\n            // Successful capture! For dev/demo purposes:\n            console.log(\"Capture result\", orderData, JSON.stringify(orderData, null, 2));\n            this.transaction_id = orderData.purchase_units[0].payments.captures[0].id;\n            console.log(\"the transaction_id is:\", this.transaction_id);\n\n            const transaction = orderData.purchase_units[0].payments.captures[0];\n            alert(\n              `Transaction ${transaction.status}: ${transaction.id}\\n\\nSee console for all available details`\n            );\n\n            // this.placeOrder();\n            // When ready to go live, remove the alert and show a success message within this page. For example:\n            // const element = document.getElementById('paypal-button-container');\n            // element.innerHTML = '<h3>Thank you for your payment!</h3>';\n            // Or go to another URL:  actions.redirect('thank_you.html');\n          });\n          return my_action;\n        },\n      })\n      .render(\"#paypal-button-container\");\n  },\n};\n</script>\n\n<style scoped>\ninput {\n  font-weight: 300;\n  color: black;\n}\nselect {\n  font-weight: 300;\n  color: black;\n}\n.lipanampesa {\n  width: 100%;\n  height: 40px;\n  padding: 2px 10px;\n  font-family: \"Source Code Pro\", monospace;\n  font-weight: 700;\n  font-size: 18px;\n  text-align: center;\n  color: #000000;\n  background: #228b22;\n  border: none;\n  transition: all 0.3s;\n  margin-bottom: 20px;\n  border-radius: 20px;\n}\n.lipanampesa:hover {\n  background-color: black;\n  color: green;\n}\n.procPayBtn {\n  margin: 20px;\n  color: #228b22;\n  background-color: black;\n  border: none;\n  border-radius: 4px;\n  transition: all 0.3s;\n  font-weight: 700;\n  font-size: 18px;\n}\n.procPayBtn:hover {\n  color: white;\n  background-color: green;\n}\n.delivery-address h5 {\n  font-family: \"Source Code Pro\", monospace;\n  font-weight: bold;\n  font-size: 18px;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}