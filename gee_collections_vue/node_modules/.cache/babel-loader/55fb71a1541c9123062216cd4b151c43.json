{"ast":null,"code":"import Modal from \"@/components/Modal.vue\";\nexport default {\n  props: ['cartGrandTotal', 'cartItemTotal', 'cartSubTotal', 'shippingCost', 'cartTotalUSD'],\n  el: '#selector',\n  components: {\n    Modal\n  },\n\n  data() {\n    return {\n      cart: {\n        cartItems: []\n      },\n      id: '',\n      first_name: '',\n      last_name: '',\n      email: '',\n      phone_number: '',\n      address: '',\n      county: '',\n      city: '',\n      town: '',\n      gender: '',\n      errors: [],\n      lipaNaMpesa: false,\n      paymentConfirm: false,\n      checked: false,\n      errors: [],\n      payment_number: '',\n      transaction_id: '',\n      isModalVisible: false,\n      mpesaRefs: [],\n      mpesaRef: '',\n      is_paid: false,\n      payment_ref: '',\n      watcherMsg: [],\n      rfStyle: null,\n      bWidth: null,\n      payment_number2: '',\n      pStyle: null,\n      p2Style: null,\n      isAuthenticated: false,\n      deliveryOption: false,\n      unknownVal: ''\n    };\n  },\n\n  watch: {\n    mpesaRef(value) {\n      this.mpesaRef = value;\n      this.validatePaymentRef(value);\n    },\n\n    payment_number2(value) {\n      this.payment_number2 = value;\n      this.validatePhoneNumber(value);\n    },\n\n    payment_number(value) {\n      this.payment_number = value;\n      this.validatePhoneNumber2(value);\n    }\n\n  },\n  computed: {\n    setShippingCost() {\n      let shipCost = 0;\n\n      if (this.cartSubTotal == 0 || this.deliveryOption == false) {\n        this.shipCost = 0;\n      } else {\n        if (this.town == 'Bondo' || this.town == 'Siaya' || this.town == 'Nairobi' || this.town == 'Ugunja') {\n          this.shipCost = 100;\n          console.log('The shipping cost is ', this.shipCost);\n        } else {\n          if (this.town == 'Busia' || this.town == 'Kiambu' || this.town == 'Kikuyu' || this.town == 'Kisumu' || this.town == 'Luanda' || this.town == 'Thika') {\n            this.shipCost = 200;\n          } else {\n            if (this.town == 'Kakamega') {\n              this.shipCost = 250;\n            } else {\n              if (this.town == 'Ahero' || this.town == 'Bungoma' || this.town == 'Machakos' || this.town == 'Mumias' || this.town == 'Naivasha' || this.town == 'Nakuru') {\n                this.shipCost = 300;\n              } else {\n                if (this.town == 'Kericho' || this.town == 'Migori' || this.town == 'Kitale') {\n                  this.shipCost = 400;\n                } else {\n                  if (this.town == 'Eldoret' || this.town == 'Embu' || this.town == 'Kisii' || this.town == 'Nyamira') {\n                    this.shipCost = 500;\n                  } else {\n                    if (this.town == 'Malindi' || this.town == 'Mombasa' || this.town == 'Mtwapa' || this.town == 'Ukunda') {\n                      this.shipCost = 600;\n                    } else {\n                      this.shipCost = 0;\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n\n      return this.shipCost;\n    },\n\n    checkoutTotal() {\n      return this.cartSubTotal + this.setShippingCost;\n    }\n\n  },\n  methods: {\n    validatePaymentRef(value) {\n      if (value.length == '') {\n        this.watcherMsg['mpesaRef'] = '';\n        this.rfStyle = '';\n        this.bWidth = 1;\n      } else {\n        if (value.length > 0 && value.length < 10) {\n          this.rfStyle = 'red';\n          this.watcherMsg['mpesaRef'] = 'Incomplete Reference Number';\n          this.bWidth = 2;\n        } else {\n          if (/^[A-Z0-9]$/.test(value) && value.length > 9) {\n            this.rfStyle = 'green';\n            this.watcherMsg['mpesaRef'] = '';\n            this.bWidth = 2;\n          }\n        }\n      }\n    },\n\n    validatePhoneNumber2(value) {\n      if (value == '') {\n        this.p2Style = '';\n        this.watcherMsg['payment_number'] = '';\n      } else {\n        if (/^(?:254)?((?:(?:7(?:(?:[01249][0-9])|(?:5[789])|(?:6[89])))|(?:1(?:[1][0-5])))[0-9]{6})$/.test(value) || /^(?:254|\\+254|0)?((?:(?:7(?:(?:3[0-9])|(?:5[0-6])|(8[5-9])))|(?:1(?:[0][0-2])))[0-9]{6})$/.test(value)) {\n          this.p2Style = 'green';\n          this.watcherMsg['payment_number'] = '';\n          this.bWidth = 2;\n        } else {\n          this.p2Style = 'red';\n          this.watcherMsg['payment_number'] = 'Invalid Phone Number';\n          this.bWidth = 2;\n        }\n      }\n    },\n\n    validatePhoneNumber(value) {\n      if (value == this.payment_number) {\n        this.pStyle = 'green';\n        this.watcherMsg['payment_number2'] = '';\n      } else {\n        this.pStyle = 'red';\n        this.watcherMsg['payment_number2'] = 'Invalid Phone Number';\n      }\n    },\n\n    getProfileDetails() {\n      this.axios.get('/api/v1/users/me/').then(response => {\n        this.phone_number = response.data.phone_number;\n        this.email = response.data.email;\n        this.id = response.data.id;\n        this.first_name = response.data.first_name;\n        this.last_name = response.data.last_name;\n        this.gender = response.data.gender;\n        this.city = response.data.city;\n        this.county = response.data.county;\n        this.address = response.data.address;\n      }).catch(error => {});\n    },\n\n    registerCallbackUrl() {\n      this.axios.get('/api/v1/c2b/register').then(response => {\n        console.log(response.data);\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n\n    async payViaMpesa() {\n      this.errors = [];\n\n      if (this.payment_number === '') {\n        this.errors.push('Please enter phone number');\n        this.$toast.error('Invalid phone number', {\n          duration: 3000\n        });\n      }\n\n      if (!this.errors.length) {\n        let formData = {\n          phone_number: this.payment_number\n        };\n        await this.axios.patch('/api/v1/payment-details/' + this.unknownVal + '/', formData).then(response => {\n          console.log(response.data);\n        }).catch(error => {\n          console.log(error);\n        }).finally(() => {\n          let formData = {\n            payment_number: this.payment_number\n          };\n          this.axios.post('/api/v1/online/lipa/', formData).then(response => {\n            console.log(response.data);\n            this.paymentConfirm = true;\n          }).catch(error => {\n            console.log(error);\n          }).finally(() => {\n            this.axios.delete('/api/v1/payment-details/' + this.unknownVal + '/').then(response => {\n              console.log(response.data);\n            }).catch(error => {\n              console.log(error);\n            });\n          });\n        });\n      }\n    },\n\n    getMpesaPayments() {\n      this.mpesaRefs = [];\n      this.axios.get('api/v1/mpesa-payments/').then(response => {\n        for (let i = 0; i < response.data.length; i++) {\n          let trans_id = response.data[i].transaction_id;\n          this.mpesaRefs.push(trans_id);\n        }\n\n        console.log(this.mpesaRefs);\n        this.isModalVisible = true;\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n\n    confirmPayment() {\n      if (this.mpesaRefs.includes(this.mpesaRef)) {\n        this.is_paid = true;\n        this.payment_ref = this.mpesaRef;\n        this.$toast.success('Payment Confirmation Succesful', {\n          duration: 3000\n        });\n        this.placeOrder();\n      } else {\n        this.$toast.error('Invalid Reference Number', {\n          duration: 3000\n        });\n      }\n    },\n\n    placeOrder() {\n      const items = [];\n\n      for (let i = 0; i < this.cart.cartItems.length; i++) {\n        const item = this.cart.cartItems[i];\n        const obj = {\n          product: item.items.id,\n          quantity: item.quantity,\n          price: item.items.price * item.quantity\n        };\n        items.push(obj);\n      }\n\n      let formData = {\n        first_name: this.first_name,\n        last_name: this.last_name,\n        address: this.address,\n        county: this.county,\n        city: this.city,\n        phone_number: this.phone_number,\n        email: this.email,\n        items: items,\n        order_total: this.cartSubTotal,\n        payment_reference: this.payment_ref,\n        paid: this.is_paid,\n        delivery_fee: this.shippingCost\n      };\n      console.log(formData);\n      this.axios.post('/api/v1/checkout/', formData).then(response => {\n        this.$store.commit('clearCart');\n        this.$toast.success('Order succesfully placed');\n        this.$router.push('/');\n        this.$store.commit('reloadingPage');\n        this.$router.push('/');\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n\n    requestDelivery() {\n      this.deliveryOption = !this.deliveryOption;\n\n      if (this.deliveryOption == false) {\n        this.town = '';\n      }\n    },\n\n    async captureDetails() {\n      if (this.lipaNaMpesa == false) {\n        let formData = {\n          first_name: this.first_name,\n          last_name: this.last_name,\n          email: this.email,\n          order_total: this.checkoutTotal\n        };\n        await this.axios.post('/api/v1/payments-list/', formData).then(response => {\n          console.log(response.data);\n          this.lipaNaMpesa = !this.lipaNaMpesa;\n        }).catch(error => {\n          console.log(error);\n        }).finally(() => {\n          this.axios.get('/api/v1/payments-list/').then(response => {\n            this.unknownVal = response.data[0].id;\n            console.log('response is ', response.data);\n            console.log('id of the response is ', this.unknownVal);\n          }).catch(error => {\n            console.log(error);\n          });\n        });\n      }\n    },\n\n    showShippingDetails() {\n      this.checked = !this.checked;\n      console.log(this.checked);\n    },\n\n    closeModal() {\n      this.isModalVisible = false;\n    },\n\n    mountPaypalButton() {},\n\n    scrollToTop() {\n      window.scrollTo({\n        top: 0,\n        behavior: \"smooth\"\n      });\n    }\n\n  },\n\n  beforeMount() {\n    this.getProfileDetails();\n    this.cart = this.$store.state.cart;\n    this.isAuthenticated = this.$store.state.isAuthenticated;\n  },\n\n  mounted() {\n    this.registerCallbackUrl();\n\n    if (!this.isAuthenticated) {\n      this.$toast.error('You need to create an account before proceeding to checkout');\n    }\n\n    paypal.Buttons({\n      //Styling the paypal button\n      style: {\n        color: 'blue',\n        shape: 'pill',\n        label: 'pay',\n        height: 40\n      },\n      // Sets up the transaction when a payment button is clicked\n      createOrder: (data, actions) => {\n        return actions.order.create({\n          purchase_units: [{\n            amount: {\n              // value: this.cartTotalUSD // Can also reference a variable or function\n              value: 0.01\n            }\n          }]\n        });\n      },\n      // Finalize the transaction after payer approval\n      onApprove: (data, actions) => {\n        const my_action = actions.order.capture().then(function (orderData) {\n          // Successful capture! For dev/demo purposes:\n          console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));\n          this.transaction_id = orderData.purchase_units[0].payments.captures[0].id;\n          console.log('the transaction_id is:', this.transaction_id);\n          const transaction = orderData.purchase_units[0].payments.captures[0];\n          alert(`Transaction ${transaction.status}: ${transaction.id}\\n\\nSee console for all available details`); // this.placeOrder();\n          // When ready to go live, remove the alert and show a success message within this page. For example:\n          // const element = document.getElementById('paypal-button-container');\n          // element.innerHTML = '<h3>Thank you for your payment!</h3>';\n          // Or go to another URL:  actions.redirect('thank_you.html');\n        });\n        return my_action;\n      }\n    }).render('#paypal-button-container');\n  }\n\n};","map":{"version":3,"mappings":"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","names":["Modal","props","el","components","data","cart","cartItems","id","first_name","last_name","email","phone_number","address","county","city","town","gender","errors","lipaNaMpesa","paymentConfirm","checked","payment_number","transaction_id","isModalVisible","mpesaRefs","mpesaRef","is_paid","payment_ref","watcherMsg","rfStyle","bWidth","payment_number2","pStyle","p2Style","isAuthenticated","deliveryOption","unknownVal","watch","value","validatePaymentRef","validatePhoneNumber","validatePhoneNumber2","computed","setShippingCost","shipCost","cartSubTotal","console","log","checkoutTotal","methods","length","test","getProfileDetails","axios","get","then","response","catch","error","registerCallbackUrl","payViaMpesa","push","$toast","duration","formData","patch","finally","post","delete","getMpesaPayments","i","trans_id","confirmPayment","includes","success","placeOrder","items","item","obj","product","quantity","price","order_total","payment_reference","paid","delivery_fee","shippingCost","$store","commit","$router","requestDelivery","captureDetails","showShippingDetails","closeModal","mountPaypalButton","scrollToTop","window","scrollTo","top","behavior","beforeMount","state","mounted","paypal","Buttons","style","color","shape","label","height","createOrder","actions","order","create","purchase_units","amount","onApprove","my_action","capture","orderData","JSON","stringify","payments","captures","transaction","alert","status","render"],"sourceRoot":"","sources":["/home/sammyb/gee_collections/gee_collections_vue/src/views/CheckoutView.vue"],"sourcesContent":["<template>\n    <div class=\"checkout\">\n        <!-- Breadcrumb Start -->\n        <div class=\"breadcrumb-wrap\">\n            <div class=\"container-fluid\">\n                <ul class=\"breadcrumb\">\n                    <li class=\"breadcrumb-item\"><router-link to=\"/\">Home</router-link></li>\n                    <li class=\"breadcrumb-item\"><router-link to=\"/cart\">Cart</router-link></li>\n                    <li class=\"breadcrumb-item active\">Checkout</li>\n                </ul>\n            </div>\n        </div>\n        <!-- Breadcrumb End -->\n        \n        <!-- Checkout Start -->\n        <div class=\"checkout\">\n            <div class=\"container-fluid\"> \n                <form action=\"\" @submit.prevent=\"placeOrder\">\n                    <div class=\"row\">\n                            <div class=\"col-lg-8\">\n                                <div class=\"checkout-inner\">\n                                    <div class=\"billing-address\">\n                                        <h2>Billing Address</h2>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-6\">\n                                                <label>First Name</label>\n                                                    <input class=\"form-control\" type=\"text\" placeholder=\"First Name\" v-model=\"first_name\">\n                                            </div>\n                                            <div class=\"col-md-6\">\n                                                <label>Last Name</label>\n                                                    <input class=\"form-control\" type=\"text\" placeholder=\"Last Name\" v-model=\"last_name\">\n                                            </div>\n                                            <div class=\"col-md-6\">\n                                                <label>E-mail</label>\n                                                    <input class=\"form-control\" type=\"email\" placeholder=\"Email\" v-model=\"email\" disabled=\"true\">\n                                            </div>\n                                            <div class=\"col-md-6\">\n                                                <label>Mobile No</label>\n                                                    <input class=\"form-control\" type=\"text\" placeholder=\"Mobile\" v-model=\"phone_number\">\n                                            </div>\n                                            <div class=\"col-md-6\">\n                                                <label>Gender</label>\n                                                    <select name=\"gender\" class=\"form-control\" v-model=\"gender\">\n                                                        <option value=\"\" disabled=\"true\">--Select your Gender--</option>\n                                                        <option>Male</option>\n                                                        <option>Female</option>\n                                                        <option>Other</option>\n                                                    </select>\n                                            </div>                                    \n                                            <div class=\"col-md-6\">\n                                                <label>Address</label>\n                                                    <input class=\"form-control\" type=\"text\" placeholder=\"Address\" v-model=\"address\">\n                                            </div>\n                                            <div class=\"col-md-6\">\n                                                <label>City</label>\n                                                    <select name=\"city\" class=\"form-control\" v-model=\"city\">\n                                                        <option value=\"\" disabled=\"true\">--Select your City--</option>\n                                                        <option>Nairobi</option>\n                                                        <option>Kisumu</option>\n                                                        <option>Mombasa</option>\n                                                        <option>Nakuru</option>\n                                                    </select>\n                                            </div>\n                                            <div class=\"col-md-6\">\n                                                <label>County</label>\n                                                    <select name=\"county\" class=\"form-control\" v-model=\"county\">\n                                                        <option value=\"\" disabled=\"true\">--Select your County--</option>\n                                                        <option>Siaya</option>\n                                                        <option>Kisumu</option>\n                                                        <option>Nairobi</option>\n                                                        <option>Mombasa</option>\n                                                    </select>\n                                            </div> \n                                            <div class=\"col-md-12\">\n                                                <div class=\"custom-control custom-checkbox\">\n                                                    <input type=\"checkbox\" class=\"custom-control-input\" id=\"newaccount\" @click=\"requestDelivery()\">\n                                                    <label class=\"custom-control-label\" for=\"newaccount\">Select if you would wish for the items to be delivered</label>  \n                                                    <div class=\"delivery-address\" v-if=\"deliveryOption\">\n                                                    <br><br>\n                                                        <h5>Delivery Address</h5>\n                                                        <div class=\"row\">\n                                                            <div class=\"col-md-6\">\n                                                                <label>Choose the delivery town</label>\n                                                                    <select name=\"town\" class=\"form-control\" v-model=\"town\">\n                                                                        <option value=\"\" disabled=\"true\">--Select your Town--</option>\n                                                                        <option>Ahero</option>\n                                                                        <option>Bondo</option>\n                                                                        <option>Bungoma</option>\n                                                                        <option>Busia</option>\n                                                                        <option>Eldoret</option>\n                                                                        <option>Embu</option>\n                                                                        <option>Kakamega</option>\n                                                                        <option>Kericho</option>\n                                                                        <option>Kiambu</option>\n                                                                        <option>Kikuyu</option>\n                                                                        <option>Kisii</option>\n                                                                        <option>Kisumu</option>\n                                                                        <option>Kitale</option>\n                                                                        <option>Luanda</option>\n                                                                        <option>Machakos</option>\n                                                                        <option>Malindi</option>\n                                                                        <option>Migori</option>\n                                                                        <option>Mombasa</option>\n                                                                        <option>Mtwapa</option>\n                                                                        <option>Mumias</option>\n                                                                        <option>Nairobi</option>\n                                                                        <option>Naivasha</option>\n                                                                        <option>Nakuru</option>\n                                                                        <option>Nyamira</option>\n                                                                        <option>Siaya</option>\n                                                                        <option>Thika</option>\n                                                                        <option>Ugunja</option>\n                                                                        <option>Ukunda</option>\n                                                                    </select>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-md-12\">\n                                                <div class=\"custom-control custom-checkbox\">\n                                                    <input type=\"checkbox\" class=\"custom-control-input\" id=\"shipto\" @click=\"showShippingDetails\">\n                                                    <label class=\"custom-control-label\" for=\"shipto\">Ship to different address</label>\n                                                    <div class=\"shipping-address\" v-if=\"checked\" >\n                                                        <h2>Shipping Address</h2>\n                                                        <div class=\"row\">\n                                                            <div class=\"col-md-6\">\n                                                                <label>First Name</label>\n                                                                <input class=\"form-control\" type=\"text\" placeholder=\"First Name\">\n                                                            </div>\n                                                            <div class=\"col-md-6\">\n                                                                <label>Last Name</label>\n                                                                <input class=\"form-control\" type=\"text\" placeholder=\"Last Name\">\n                                                            </div>\n                                                            <div class=\"col-md-6\">\n                                                                <label>E-mail</label>\n                                                                <input class=\"form-control\" type=\"text\" placeholder=\"E-mail\">\n                                                            </div>\n                                                            <div class=\"col-md-6\">\n                                                                <label>Mobile No</label>\n                                                                <input class=\"form-control\" type=\"text\" placeholder=\"Mobile No\">\n                                                            </div>\n                                                            <div class=\"col-md-12\">\n                                                                <label>Address</label>\n                                                                <input class=\"form-control\" type=\"text\" placeholder=\"Address\">\n                                                            </div>\n                                                            <div class=\"col-md-6\">\n                                                                <label>Country</label>\n                                                                <select class=\"custom-select\">\n                                                                    <option selected>Kenya</option>\n                                                                    <option>Tanzania</option>\n                                                                    <option>Uganda</option>\n                                                                    <option>Rwanda</option>\n                                                                </select>\n                                                            </div>\n                                                            <div class=\"col-md-6\">\n                                                                <label>City</label>\n                                                                <input class=\"form-control\" type=\"text\" placeholder=\"City\">\n                                                            </div>\n                                                            <div class=\"col-md-6\">\n                                                                <label>County</label>\n                                                                <input class=\"form-control\" type=\"text\" placeholder=\"County\">\n                                                            </div>\n                                                            <div class=\"col-md-6\">\n                                                                <label>ZIP Code</label>\n                                                                <input class=\"form-control\" type=\"text\" placeholder=\"ZIP Code\">\n                                                            </div>\n                                                        </div>\n                                                    </div>                                                \n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"col-lg-4\">\n                                <div class=\"checkout-inner\">\n                                    <div class=\"checkout-summary\">\n                                        <h1>Cart Total</h1>\n                                        <p class=\"sub-total\">Sub Total<span>ksh. {{Number(cartSubTotal).toLocaleString()}}</span></p>\n                                        <!-- <p class=\"ship-cost\">Shipping Cost<span>ksh. {{Number(shippingCost).toLocaleString()}}</span></p> -->\n                                        <p class=\"ship-cost\">Delivery Fee<span>ksh. {{Number(setShippingCost).toLocaleString()}}</span></p>\n                                        <!-- <h2>Grand Total<span>{{Number(cartGrandTotal).toLocaleString()}}</span></h2> -->\n                                        <h2>Grand Total<span>{{Number(checkoutTotal).toLocaleString()}}</span></h2>\n    \n                                    </div>\n\n                                    <div class=\"checkout-payment\">\n                                    <h1>Payment Methods</h1>\n                                        <button type=\"button\" class=\"lipanampesa\" @click=\"captureDetails()\">Lipa Na Mpesa</button>\n                                        <div v-if=\"lipaNaMpesa\">\n                                            <p>To proceed to Lipa Na Mpesa, please enter the phone number you would like to make the payment with.</p>\n                                            <label for=\"\">Phone Number:</label>\n                                            <input type=\"text\" class=\"form-control\" placeholder=\"e.g 2547XXXXXXXX\" v-model=\"payment_number\" :style=\"{borderColor: p2Style,borderWidth: bWidth+'px'}\">\n                                            <span v-if=\"watcherMsg.payment_number\" :style=\"{color: p2Style, fontSize:10 + 'px'}\">{{watcherMsg.payment_number}}</span>\n                                            <div class=\"col-md-12 notification is-danger\" v-if=\"errors.length\">\n                                                <p style=\"color: red;\" v-for=\"error in errors\" v-bind:key=\"error\">{{ error }}</p>\n                                            </div>\n                                            <button type=\"button\" class=\"procPayBtn\" @click=\"payViaMpesa\">Proceed to Pay</button>\n                                            <p v-if=\"paymentConfirm\">An mpesa prompt has been sent to the number entered above,enter your mpesa PIN then proceed to payment confirmation</p>\n                                            <button type=\"button\" class=\"procPayBtn\" @click=\"getMpesaPayments\" v-if=\"paymentConfirm\">Confirm Payment</button>\n                                        </div>\n\n                                         <!-- MODAL component for confirming payment -->\n                                         <Modal\n                                        v-show=\"isModalVisible\"\n                                        @close=\"closeModal\"\n                                        >\n                                        <template v-slot:header>\n                                            M-Pesa Payment Confirmation\n                                        </template>\n\n                                        <template v-slot:body>\n                                        <div>\n                                        <p>Please confirm the details of your payments to succesfully place your order</p>\n                                        <label for=\"\">Phone Number:</label>\n                                        <input type=\"text\" class=\"form-control\" placeholder=\"e.g 2547XXXXXXXX\" :style=\"{borderColor: pStyle,borderWidth: bWidth+'px'}\">\n                                        <span v-if=\"watcherMsg.payment_number2\" :style=\"{color: pStyle, fontSize:10 + 'px'}\">{{watcherMsg.payment_number2}}</span>\n                                        <label for=\"\">Reference Number:</label>\n                                        <input type=\"text\" class=\"form-control\" placeholder=\"e.g QRYU0U***P1\" v-model=\"mpesaRef\" :style=\"{borderColor: rfStyle,borderWidth: bWidth+'px'}\">\n                                        <span v-if=\"watcherMsg.mpesaRef\" :style=\"{color: rfStyle, fontSize:10 + 'px'}\">{{watcherMsg.mpesaRef}}</span>\n                                        <button type=\"button\" class=\"procPayBtn\" @click=\"confirmPayment\">Confirm Payment</button>                                        \n                                        </div>\n                                        </template>\n\n                                        <template v-slot:footer>\n                                            Thank you for doing business with us.\n                                        </template>\n\n                                        </Modal>\n                                        <div id=\"paypal-button-container\"></div>\n                                        <div class=\"checkout-btn\" >\n                                            <button>Place Order</button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>   \n                    </div>\n                </form>\n            </div>\n        </div>\n        <!-- Checkout End -->\n    </div>\n</template>\n\n<script>\nimport Modal from \"@/components/Modal.vue\"\nexport default {\n    props:['cartGrandTotal','cartItemTotal','cartSubTotal','shippingCost','cartTotalUSD'],\n    el:'#selector',\n    components:{\n        Modal\n    },\n    data(){\n        return{\n            cart:{\n                cartItems:[]\n            },\n            id:'',\n            first_name:'',\n            last_name: '',\n            email: '',\n            phone_number: '',\n            address: '',\n            county: '',\n            city: '',\n            town:'',\n            gender: '',\n            errors:[],\n            lipaNaMpesa: false,\n            paymentConfirm: false,\n            checked: false,\n            errors:[],\n            payment_number: '',\n            transaction_id:'',\n            isModalVisible: false,\n            mpesaRefs: [],\n            mpesaRef : '',\n            is_paid : false,\n            payment_ref: '',\n            watcherMsg: [],\n            rfStyle : null,\n            bWidth : null,\n            payment_number2: '',\n            pStyle: null,\n            p2Style: null,\n            isAuthenticated: false,\n            deliveryOption: false,\n            unknownVal : '',\n        }\n    },\n    watch:{\n        mpesaRef(value){\n            this.mpesaRef = value;\n            this.validatePaymentRef(value);\n        },\n        payment_number2(value){\n            this.payment_number2 = value;\n            this.validatePhoneNumber(value)\n        },   \n        payment_number(value){\n            this.payment_number = value;\n            this.validatePhoneNumber2(value)\n        },      \n    },\n    computed:{\n        setShippingCost(){\n            let shipCost = 0;\n            if (this.cartSubTotal == 0 || this.deliveryOption == false){\n                 this.shipCost = 0\n            }else{\n                if(this.town == 'Bondo'||this.town == 'Siaya'||this.town == 'Nairobi'||this.town == 'Ugunja'){\n                   this.shipCost = 100\n                   console.log('The shipping cost is ',this.shipCost)\n                }\n                else{\n                    if(this.town == 'Busia'||this.town == 'Kiambu'||this.town == 'Kikuyu'||this.town == 'Kisumu'||this.town == 'Luanda'||this.town == 'Thika'){\n                        this.shipCost = 200\n                    }else{\n                        if(this.town == 'Kakamega'){\n                            this.shipCost = 250\n                        }else{\n                            if(this.town == 'Ahero'||this.town == 'Bungoma'||this.town == 'Machakos'||this.town == 'Mumias'||this.town == 'Naivasha'||this.town == 'Nakuru'){\n                                this.shipCost = 300\n                            }else{\n                                if(this.town == 'Kericho'||this.town == 'Migori'||this.town == 'Kitale'){\n                                    this.shipCost = 400\n                                }\n                                else{\n                                    if(this.town == 'Eldoret'||this.town == 'Embu'||this.town == 'Kisii'||this.town == 'Nyamira'){\n                                        this.shipCost = 500\n                                    }else{\n                                        if(this.town == 'Malindi'||this.town == 'Mombasa'||this.town == 'Mtwapa'||this.town == 'Ukunda'){\n                                            this.shipCost = 600\n                                        }else{\n                                            this.shipCost = 0\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n            return this.shipCost\n        },\n        checkoutTotal(){\n            return this.cartSubTotal + this.setShippingCost\n        }\n    },\n    methods:{\n        validatePaymentRef(value){\n            if(value.length == ''){\n                this.watcherMsg['mpesaRef'] = '';\n                this.rfStyle = '';\n                this.bWidth = 1;\n            }\n            else{\n                if(value.length > 0 && value.length < 10){\n                    this.rfStyle = 'red';\n                    this.watcherMsg['mpesaRef'] = 'Incomplete Reference Number';\n                    this.bWidth = 2;\n                }\n                else{\n                    if(/^[A-Z0-9]$/.test(value) && value.length > 9){\n                        this.rfStyle = 'green';\n                        this.watcherMsg['mpesaRef'] = '';\n                        this.bWidth = 2;\n                    }\n                }\n            }\n        },\n        validatePhoneNumber2(value){\n            if(value == ''){\n                this.p2Style = '';\n                this.watcherMsg['payment_number'] = ''                        \n            }\n            else{\n                if ((/^(?:254)?((?:(?:7(?:(?:[01249][0-9])|(?:5[789])|(?:6[89])))|(?:1(?:[1][0-5])))[0-9]{6})$/.test(value))|| (/^(?:254|\\+254|0)?((?:(?:7(?:(?:3[0-9])|(?:5[0-6])|(8[5-9])))|(?:1(?:[0][0-2])))[0-9]{6})$/.test(value))){\n                    this.p2Style = 'green';\n                    this.watcherMsg['payment_number'] = ''\n                    this.bWidth = 2\n                }\n                else{\n                    this.p2Style = 'red';\n                    this.watcherMsg['payment_number'] = 'Invalid Phone Number'\n                    this.bWidth = 2\n                }\n            }\n        },\n        validatePhoneNumber(value){\n            if(value == this.payment_number){\n                this.pStyle = 'green';\n                this.watcherMsg['payment_number2'] = ''                        \n            }\n            else{\n                this.pStyle = 'red';\n                this.watcherMsg['payment_number2'] = 'Invalid Phone Number'\n            }\n            \n        },\n        getProfileDetails(){\n            this.axios.get('/api/v1/users/me/')\n            .then((response)=>{\n                this.phone_number = response.data.phone_number;\n                this.email = response.data.email;\n                this.id = response.data.id;\n                this.first_name = response.data.first_name\n                this.last_name = response.data.last_name\n                this.gender = response.data.gender\n                this.city = response.data.city\n                this.county = response.data.county\n                this.address = response.data.address\n            })\n            .catch((error)=>{\n\n            })\n        },\n        registerCallbackUrl(){\n            this.axios.get('/api/v1/c2b/register')\n            .then((response)=>{\n                console.log(response.data)\n            })\n            .catch((error)=>{\n                console.log(error)\n            })\n        },\n        async payViaMpesa(){\n            this.errors = []\n            if(this.payment_number === ''){\n                this.errors.push('Please enter phone number');\n                this.$toast.error('Invalid phone number', {\n                    duration: 3000\n                })\n            }\n            if(!this.errors.length){\n                let formData = {\n                    phone_number: this.payment_number\n                }\n                await this.axios.patch('/api/v1/payment-details/'+this.unknownVal+'/',formData)\n                .then((response)=>{\n                    console.log(response.data)\n                })\n                .catch((error)=>{\n                    console.log(error)\n                })\n                .finally(()=>{\n                    let formData = {\n                    payment_number: this.payment_number\n                    }\n                    this.axios.post('/api/v1/online/lipa/',formData)\n                    .then((response)=>{\n                        console.log(response.data)\n                        this.paymentConfirm = true;\n                    })\n                    .catch((error)=>{\n                        console.log(error)\n                    })\n                    .finally(()=>{\n                        this.axios.delete('/api/v1/payment-details/'+this.unknownVal+'/')\n                        .then((response)=>{\n                            console.log(response.data)\n                        })\n                        .catch((error)=>{\n                            console.log(error)\n                        })\n                    })\n                })\n            }\n        },\n        getMpesaPayments(){\n            this.mpesaRefs = []\n            this.axios.get('api/v1/mpesa-payments/')\n            .then((response)=>{\n                for(let i=0 ; i<response.data.length ; i++){\n                    let trans_id = response.data[i].transaction_id\n                    this.mpesaRefs.push(trans_id)\n                    \n                }\n                console.log(this.mpesaRefs)\n                this.isModalVisible = true;\n            })\n            .catch((error)=>{\n                console.log(error)\n            })\n        },\n        confirmPayment(){\n            if(this.mpesaRefs.includes(this.mpesaRef)){\n               this.is_paid = true;\n               this.payment_ref = this.mpesaRef;\n               this.$toast.success('Payment Confirmation Succesful', {\n                    duration: 3000\n                })\n                this.placeOrder();\n            }\n            else{\n                this.$toast.error('Invalid Reference Number', {\n                    duration: 3000\n                })\n            }\n        },\n        placeOrder(){\n            const items = []\n            for (let i = 0; i < this.cart.cartItems.length; i++) {\n            const item = this.cart.cartItems[i]\n            const obj = {\n                product: item.items.id,\n                quantity: item.quantity,\n                price: item.items.price * item.quantity\n            }\n            items.push(obj)\n            \n            }           \n            let formData={\n                first_name:this.first_name,\n                last_name: this.last_name,\n                address: this.address,\n                county: this.county,\n                city: this.city,   \n                phone_number: this.phone_number,\n                email: this.email,\n                items: items,\n                order_total: this.cartSubTotal,\n                payment_reference: this.payment_ref,\n                paid : this.is_paid,\n                delivery_fee : this.shippingCost,\n            }\n            console.log(formData)\n            this.axios.post('/api/v1/checkout/', formData)\n            .then((response)=>{\n                this.$store.commit('clearCart')\n                this.$toast.success('Order succesfully placed')\n                this.$router.push('/')\n                this.$store.commit('reloadingPage')\n                this.$router.push('/')\n            })\n            .catch((error)=>{\n                console.log(error)\n            })\n        },\n        requestDelivery(){\n            this.deliveryOption = !this.deliveryOption\n            if(this.deliveryOption == false){\n                this.town = ''\n            }\n        },\n        async captureDetails(){\n            if(this.lipaNaMpesa == false){\n                let formData = {\n                    first_name: this.first_name,\n                    last_name: this.last_name,\n                    email: this.email,\n                    order_total: this.checkoutTotal,\n                }\n                await this.axios.post('/api/v1/payments-list/', formData)\n                .then((response)=>{\n                    console.log(response.data)\n                    this.lipaNaMpesa = !this.lipaNaMpesa\n                })\n                .catch((error)=>{\n                    console.log(error)\n                })\n                .finally(()=>{\n                    this.axios.get('/api/v1/payments-list/')\n                    .then((response)=>{\n                        this.unknownVal = response.data[0].id\n                        console.log('response is ',response.data)\n                        console.log('id of the response is ',this.unknownVal)\n                    })\n                    .catch((error)=>{\n                        console.log(error)\n                    })\n                })\n            }\n        },\n        showShippingDetails(){\n            this.checked = !this.checked\n            console.log(this.checked)\n        },\n        closeModal() {\n            this.isModalVisible = false;\n        },        \n        mountPaypalButton(){\n\n        },\n        scrollToTop(){\n            window.scrollTo({top:0,behavior:\"smooth\"})\n        }\n    },\n    beforeMount() {\n        this.getProfileDetails();\n        this.cart = this.$store.state.cart;\n        this.isAuthenticated = this.$store.state.isAuthenticated\n    },\n    mounted(){\n        this.registerCallbackUrl()\n        if(!this.isAuthenticated){\n            this.$toast.error('You need to create an account before proceeding to checkout')\n        }\n        paypal.Buttons({\n            //Styling the paypal button\n            style: {\n                color: 'blue',\n                shape: 'pill',\n                label: 'pay',\n                height: 40\n            },\n            // Sets up the transaction when a payment button is clicked\n            createOrder: (data, actions) => {\n            return actions.order.create({\n                purchase_units: [{\n                amount: {\n                    // value: this.cartTotalUSD // Can also reference a variable or function\n                    value: 0.01\n                }\n                }]\n            });\n            },\n            // Finalize the transaction after payer approval\n            onApprove: (data, actions) => {   \n                const my_action = actions.order.capture().then(function(orderData) {\n                    // Successful capture! For dev/demo purposes:\n                    console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));\n                    this.transaction_id = orderData.purchase_units[0].payments.captures[0].id\n                    console.log('the transaction_id is:', this.transaction_id)\n                    \n                    const transaction = orderData.purchase_units[0].payments.captures[0];\n                    alert(`Transaction ${transaction.status}: ${transaction.id}\\n\\nSee console for all available details`);\n                    \n                    \n                    // this.placeOrder();\n                    // When ready to go live, remove the alert and show a success message within this page. For example:\n                    // const element = document.getElementById('paypal-button-container');\n                    // element.innerHTML = '<h3>Thank you for your payment!</h3>';\n                    // Or go to another URL:  actions.redirect('thank_you.html');\n                });\n                return my_action;\n            }\n        }).render('#paypal-button-container');\n    }\n}\n\n</script>\n\n<style scoped>\n    input{\n        font-weight: 300;\n        color: black;\n    }\n    select{\n        font-weight: 300;\n        color: black;\n    }\n    .lipanampesa{\n        width: 100%;\n        height: 40px;\n        padding: 2px 10px;\n        font-family: 'Source Code Pro', monospace;\n        font-weight: 700;\n        font-size: 18px;\n        text-align: center;\n        color: #000000;\n        background: #228B22;\n        border: none;\n        transition: all .3s;\n        margin-bottom: 20px;\n        border-radius: 20px;\n    }\n    .lipanampesa:hover{\n        background-color: black;\n        color: green;\n    }\n    .procPayBtn{\n        margin: 20px;\n        color:#228B22;\n        background-color: black;\n        border: none;\n        border-radius: 4px;\n        transition: all .3s;\n        font-weight: 700;\n        font-size: 18px;\n    }\n    .procPayBtn:hover{\n        color: white;\n        background-color: green;\n    }\n    .delivery-address h5{\n        font-family: 'Source Code Pro', monospace;\n        font-weight: bold;\n        font-size: 18px;\n    }\n</style>"]},"metadata":{},"sourceType":"module"}